name: Build Docker Image

on:
  push:
    branches:
      - main          # baue bei Push auf main
  workflow_dispatch:   # manuell ausl√∂sbar im GitHub UI

jobs:
  nodejs-docker-build-push:
    name: NodeJS / Docker Build / Docker Push
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository 
        uses: actions/checkout@v4

      - name: Set up Node.js # Sets up Node.js environment
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Install dependencies # Installs npm packages
        run: npm ci

      - name: Log in to Docker Hub # Login Data saved in GitHub Secrets
        uses: docker/login-action@v3
        with:
          username: ${{ secrets.DOCKERHUB_USERNAME }}
          password: ${{ secrets.DOCKERHUB_TOKEN }}

      - name: Build Docker image # Builds Image with latest tag
        run: |
          docker build -t fdai7814/express-web:latest .

      - name: Push Docker image # Pushes Image to Docker Hub ONLY IF build is successful
        run: |
          docker push fdai7814/express-web:latest